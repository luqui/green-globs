<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
<script src="globs.js"></script>
<script src="levels.js"></script>

<script>
$(function() {

var Globs = GlobsModule(jQuery, $('#canvas')[0], {});
var Levels = LevelsModule(Globs);

var current_level = 0;

var state;
var start_level = function() {
    $('#score').text(0);
    $('#next').attr('disabled', 'disabled');
    state = Globs.newState(Levels.levels[current_level].globs(), function(s) {
        $('#score').text(s.score);
        if (s.score >= Levels.levels[current_level].required_score) {
            $('#next').removeAttr('disabled');
        }
    });
    Globs.clearScreen();
    Globs.drawAxes();
    Globs.drawGlobs(state.globs);
};

start_level(0);

var plot = function() {
    var f = Globs.parse($('.input input').val());
    Globs.run(state, f);
};
$('.input button').click(plot);

$('.input input').keydown(function(e) {
    if (e.keyCode == 13) { plot(); }
});

$('#retry').click(start_level);
$('#next').click(function() {
    current_level++;
    start_level();
});

})
</script>

<style>
.input {
  width: 640px;
  font-size: 20pt;
}
.input * {
  font-size: 20pt;
}
.header {
  font-size: 20pt;
  width: 640px;
}
#score {
  color: red;
}
.score {
  float: left;
}
.levelcontrols {
  float: right;
}
</style>

</head>
<body>
  <div class="header">
   <div class="score">Score: <span name="score" id="score">0</span></div>
   <div class="levelcontrols">
    <button name="retry" id="retry">Retry</button>
    <button name="next" id="next">Next Level</button>
   </div>
  </table>
  </div>
  <canvas id="canvas" width="640" height="480"> 
   Canvas not supported.  Use Firefox or Chrome, kthxbye.
  </canvas>
  <div class="input">
    y = <input type="text" />
    <button>Fire</button>
  </div>
</body>
</html>
