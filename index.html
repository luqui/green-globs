<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
<script src="globs.js"></script>
<script src="levels.js"></script>

<script>
$(function() {

var Globs = GlobsModule(jQuery, $('#canvas')[0], {});
var Levels = LevelsModule(Globs);

var current_level = 0;

var state;
var start_level = function() {
    $('.levelno').text("Level " + (current_level+1));
    $('#score').text(0);
    $('#next').attr('disabled', 'disabled');
    $('#next').text("Next Level (" + Levels.levels[current_level].required_score + ")");
    state = Globs.newState(Levels.levels[current_level].globs(), function(s) {
        $('#score').text(s.score);
        if (s.score >= Levels.levels[current_level].required_score) {
            $('#next').removeAttr('disabled');
        }
    });
    Globs.clearScreen();
    Globs.drawAxes();
    Globs.drawGlobs(state.globs);
};

start_level(0);

var plot = function() {
    var f = Globs.parse($('.input input').val());
    Globs.run(state, f);
};
$('.input button').click(plot);

$('.input input').keydown(function(e) {
    if (e.keyCode == 13) { plot(); }
});

$('#retry').click(start_level);
$('#next').click(function() {
    current_level++;
    start_level();
});

})
</script>

<style>
.game {
  width: 640px;
}
.game * {
  font-size: 20pt;
}
button.nav {
  font-size: 15pt;
}
#score {
  color: red;
}
.score {
  float: left;
}
.levelcontrols {
  float: right;
}
.levelno {
  text-decoration: underline;
  margin-bottom: 20px;
}
</style>

</head>
<body>
 <center>
  <div class="game">
   <div class="levelno"></div>
   <div class="header">
    <div class="score">Score: <span name="score" id="score">0</span></div>
    <div class="levelcontrols">
     <button class="nav" name="retry" id="retry">Retry</button>
     <button class="nav" name="next" id="next">Next Level</button>
    </div>
   </table>
   </div>
   <canvas id="canvas" width="640" height="480"> 
    Canvas not supported.  Use Firefox or Chrome, kthxbye.
   </canvas>
   <div class="input">
     y = <input type="text" />
     <button>Fire</button>
   </div>
  </div>
 <center>
</body>
</html>
